p8105_hw3_mh4588.Rmd
================
Maggie Hsu
2024-10-17

### Data Exploration

``` r
library(tidyverse) #Import the Tidyverse library and additional libraries
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(p8105.datasets)
library(patchwork)
library(hexbin)

data("ny_noaa") #Load NOAA data from the datasets library
```

    The dataset "ny_noaa" consists of 2595176 rows and 7 variables, which are: id, date, prcp, snow, snwd, tmax, tmin. These variables describe each observation through its ID, date observed, and the levels of precipitation, snowfall, snow depth, and maximum/minimum temperatures. From the summary statistics of this dataset, missing data is an issue for the weather variables (precipitation, snowfall, snow depth, and temperature extremes) due to the amount of NAs present.


    ### Data Cleaning and Observations

    ``` r
    #Created separate variables for year, month, and day and also converted minimum/maximum temperature variables into numeric values.
    ny_noaa = 
      mutate(
        ny_noaa,
        date = ymd(date),
        year = year(date), 
        month = month(date), 
        day = day(date),
        tmax=as.numeric(tmax), 
        tmin = as.numeric(tmin)
        ) 

    #Most commonly observed values for snowfall 
    ny_noaa |>
      count(snow)

    ## # A tibble: 282 × 2
    ##     snow       n
    ##    <int>   <int>
    ##  1   -13       1
    ##  2     0 2008508
    ##  3     3    8790
    ##  4     5    9748
    ##  5     8    9962
    ##  6    10    5106
    ##  7    13   23095
    ##  8    15    3672
    ##  9    18    3226
    ## 10    20    4797
    ## # ℹ 272 more rows

The most commonly observed value for snow is 0 because most days in New
York do not have any snow.

### Average Maximum Temperatures in January and July

``` r
ny_noaa |>
  group_by(id, year, month) |>
  filter(month %in% c(1, 7)) |>
  summarize(mean_tmax = mean(tmax, na.rm = TRUE, color = id)) %>% 
  ggplot(aes(x = year, y = mean_tmax, group = id, color=year)) +
  geom_point() + 
  geom_path() + 
  facet_grid(.~month)
```

    ## `summarise()` has grouped output by 'id', 'year'. You can override using the
    ## `.groups` argument.

    ## Warning: Removed 5970 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

    ## Warning: Removed 5931 rows containing missing values or values outside the scale range
    ## (`geom_path()`).

![](p8105_hw3_mh4588_files/figure-gfm/tmax%20tmin-1.png)<!-- -->

``` r
  labs(title="Mean Maximum vs. Minimum Temperatures by Year", x="Year", y="Temperature")
```

    ## $x
    ## [1] "Year"
    ## 
    ## $y
    ## [1] "Temperature"
    ## 
    ## $title
    ## [1] "Mean Maximum vs. Minimum Temperatures by Year"
    ## 
    ## attr(,"class")
    ## [1] "labels"

Although maximum and minumum temperatures tend to fluctuate over time,
the mean minimum temperature shows an increase from 1980 to 2010 while
the mean maximum temperature is stable. There also seems to be some
extreme observations (such as a very low minimum for 1980 and 2005 and a
very low maximum slightly before 1990)

### Distribution of Snowfall and Temperatures

``` r
#Plot temperatures
temperatures = ny_noaa |>
  ggplot(aes(x = tmin, y = tmax)) + geom_hex()
  
#Distribution of snowfall values by year
snowfall = ny_noaa |>
  filter(snow > 0, snow < 100) |>
  ggplot(aes(x = as.factor(year), y = snow, fill=year)) +
  geom_boxplot()

temperatures + snowfall
```

    ## Warning: Removed 1136276 rows containing non-finite outside the scale range
    ## (`stat_binhex()`).

![](p8105_hw3_mh4588_files/figure-gfm/snowfall-1.png)<!-- -->

# Problem 2

``` r
#Read in datasets
covar <- read.csv("./data/nhanes_covar.csv")
accel <- read.csv("./data/nhanes_accel.csv")

#Clean data
#Rename rows and remove first four blank rows
covar <- janitor::row_to_names(covar, 4) |>
  filter(age >= 21) |> #Exclude participants under 21 years old
  mutate( #Encode variables into appropriate classes
    SEQN = as.numeric(SEQN),
    sex = factor(sex, labels=c("male","female")),
    age = as.numeric(age), 
    BMI = as.numeric(BMI),
    education = factor(education, labels = c("Less than High School","High School Equivalent", "More than High School")),
  )

#Merge frames based on SEQN
nhanes <- left_join(covar,accel, by="SEQN") |>
  #Remove rows with missing demographic values
  drop_na(SEQN,sex,age,BMI,education)
    
#Create a long/tidy version of the nhanes dataframe
nhanes_long <- pivot_longer(nhanes, min1:min1440, names_to = "time", values_to = "mims")

nhanes_long = mutate(nhanes_long, time= str_sub(time, 4, -1))
nhanes_long = mutate(nhanes_long, time= as.numeric(time)) |>
drop_na(SEQN,sex,age,BMI,education, time, mims)
```

``` r
#Set up table comparing the number of men and women in each level of education
nhanes |>
  janitor::tabyl(sex, education)
```

    ##     sex Less than High School High School Equivalent More than High School
    ##    male                    27                     35                    56
    ##  female                    28                     23                    59

``` r
#Visualization
nhanes |>
  ggplot(aes(x = sex, y = age, fill = sex)) + 
    facet_grid(~education) + geom_boxplot()
```

![](p8105_hw3_mh4588_files/figure-gfm/nhanes%20table-1.png)<!-- --> Most
participants were in the “More than High School” category as compared to
the other two educational levels, while the amount of male and female
participants were at similar levels, there were many more male
participants at the High School level than female participants.

The median ages for male and female participants for Less than High
School are similar, while for High School Equivalent the male
participants tended to be younger than the female participants. For More
than High School, the male and female participants’ age distributions
tended younger than for the other groups and had similar
medians–although it was slightly lower for female participants.

``` r
#Create a total activity variable by summing up individual minute activity values for all columns
nhanes = mutate(nhanes, activity = rowSums(across(min1:min1440)))

#Plot activity compared to age, sex, and education levels.
nhanes |>
    ggplot(aes(x=age, y=activity)) + 
  facet_grid( .~education) +  
  geom_point(aes(color = sex)) +
  geom_smooth(se = FALSE) +
  labs(title="Daily Activity Level by Age and Education Level", y="Activity (MIMS Units)", x="Age")
```

    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

![](p8105_hw3_mh4588_files/figure-gfm/nhanes%20total%20activity-1.png)<!-- -->
There is a negative association between activity level and age for all
of the observed education levels as the lines of best fit were all
downward trending. It is interesting that in “High School Equivalent”,
activity levels increase until 40 but then decrease, while activity
levels slightly increase at age 60 for “Less than High School” but then
decrease again.

``` r
#Three-panel plot showing activity level over time
nhanes_long |>
  ggplot(aes(x=time, y=mims)) + 
  facet_grid( .~education) +  
  geom_point(aes(color = sex)) +
  geom_smooth(se = FALSE) +
  labs(title="Daily Activity Over 24 Hours by Age and Education Level", y="Activity (MIMS Units)", x="Time")
```

    ## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'

![](p8105_hw3_mh4588_files/figure-gfm/nhanes%2024%20hour-1.png)<!-- -->
All of the education levels show a pattern where activity tends to start
off at a moderate level, dips slightly before 500 minutes, and then
increases shortly after 500 minutes. The activity level then stays
relatively level (or slightly decreases for “Less than High School”
participants) until roughly 1000 minutes in, where the activity level
decreases until at a similar level to the starting activity level. Male
and female participants had similar activity patterns, although for
“More than High School” the male participants showed a spike in activity
around 500 minutes in while female participants showed a spike somewhat
after 1000 minutes in.

# Problem 3

``` r
#Read in data
jan_2020 <- read.csv("./data/citibike/Jan 2020 Citi.csv") 
jan_2024 <- read.csv("./data/citibike/Jan 2020 Citi.csv")
july_2020 <- read.csv("./data/citibike/July 2020 Citi.csv")
july_2024 <- read.csv("./data/citibike/July 2024 Citi.csv")

#Add identifier variables
jan_2020 = mutate(jan_2020, month = "January 2020")
jan_2024 = mutate(jan_2024, month = "January 2024")
july_2020 = mutate(july_2020, month = "July 2020")
july_2024 = mutate(july_2024, month = "July 2024")

#Merge all datasets
citibike <- bind_rows(jan_2020, jan_2024, july_2020, july_2024)
```

``` r
citibike |>
  group_by(member_casual, month) |> #Group by member types and summarize
  summarize(total_rides = n()) 
```

    ## `summarise()` has grouped output by 'member_casual'. You can override using the
    ## `.groups` argument.

    ## # A tibble: 8 × 3
    ## # Groups:   member_casual [2]
    ##   member_casual month        total_rides
    ##   <chr>         <chr>              <int>
    ## 1 casual        January 2020         984
    ## 2 casual        January 2024         984
    ## 3 casual        July 2020           5637
    ## 4 casual        July 2024          10894
    ## 5 member        January 2020       11436
    ## 6 member        January 2024       11436
    ## 7 member        July 2020          15411
    ## 8 member        July 2024          36262

There tend to be more citibike rides in July as compared to in January
for both members and casual riders, which may be due to warmer weather
over the summer. Members have more overall rides as compared to casual
users as members may be more inclined to regularly use citibikes, while
there are either the same or more rides in 2024 overall as pandemic
restrictions and quarantines in 2020 would have made people less likely
to go out or rent bikes.

## The 5 most popular starting stations in July 2024

``` r
citibike |> 
  filter(month=="July 2024") |>
  group_by(start_station_name) |> #Group by station name and number of rides per station
  summarize(originating_rides = n())|>
  filter(min_rank(desc(originating_rides)) < 6) 
```

    ## # A tibble: 5 × 2
    ##   start_station_name       originating_rides
    ##   <chr>                                <int>
    ## 1 Pier 61 at Chelsea Piers               163
    ## 2 University Pl & E 14 St                155
    ## 3 W 21 St & 6 Ave                        152
    ## 4 W 31 St & 7 Ave                        146
    ## 5 West St & Chambers St                  150

## Visualizations

### Plot 1

``` r
citibike |>
  group_by(month) |>
  ggplot()+
  geom_boxplot(aes(x=weekdays, y=duration, fill=weekdays))+ 
  facet_grid( .~month) +
  labs(title="Citibike Durations by Days of the Week", x ="Day of the Week", y="Duration")
```

![](p8105_hw3_mh4588_files/figure-gfm/citibike%20plot%201-1.png)<!-- -->
In general, there tended to be more rides on Saturday and Sunday as
compared to the weekdays, especially on Tuesdays and Wednesdays. July
has a wider range of ride durations and a higher maximum for both 2020
and 2024, suggesting that people may tend to ride bikes more over the
summer as compared to January. There are also more long-duration
outliers for July rides.

### Plot 2

``` r
citibike |>
  filter(month == c("January 2024","July 2024")) |>
  ggplot(aes(x=month, y=duration, color=member_casual) 
  )+
  geom_boxplot() +
  labs(title="Citibike Usage Patterns in 2024")
```

![](p8105_hw3_mh4588_files/figure-gfm/citibike%20plot%202-1.png)<!-- -->

From this graphic, casual users tended to have a higher range of bike
durations as compared to members, and had a higher minimum, maximum, and
median for these values for both January and July 2024. The duration
patterns were generally similar for both January and July, although for
outliers, there were higher amounts of high-duration outliers for July
2024 as compared to January.
